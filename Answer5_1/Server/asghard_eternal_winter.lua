local animationDelay = 300

local combat = {}

local area = {
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {1, 1, 1, 1, 2, 1, 1, 1, 1},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 0, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 1, 1, 0, 0},
	 {0, 0, 0, 0, 1, 1, 1, 1, 0},
	 {0, 0, 0, 0, 2, 1, 1, 1, 1},
	 {0, 0, 0, 0, 1, 1, 1, 1, 0},
	 {0, 0, 0, 0, 1, 1, 1, 0, 0},
	 {0, 0, 0, 0, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 0, 0, 0, 0},
	 {0, 0, 1, 1, 1, 0, 0, 0, 0},
	 {0, 1, 1, 1, 1, 0, 0, 0, 0},
	 {1, 1, 1, 1, 2, 0, 0, 0, 0},
	 {0, 1, 1, 1, 1, 0, 0, 0, 0},
	 {0, 0, 1, 1, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 0, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {1, 1, 1, 1, 2, 1, 1, 1, 1},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {1, 1, 1, 1, 2, 1, 1, 1, 1},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
	{{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 0, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 1, 1, 0, 0},
	 {0, 0, 0, 0, 1, 1, 1, 1, 0},
	 {0, 0, 0, 0, 2, 1, 1, 1, 1},
	 {0, 0, 0, 0, 1, 1, 1, 1, 0},
	 {0, 0, 0, 0, 1, 1, 1, 0, 0},
	 {0, 0, 0, 0, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 0, 0, 0, 0},
	 {0, 0, 1, 1, 1, 0, 0, 0, 0},
	 {0, 1, 1, 1, 1, 0, 0, 0, 0},
	 {1, 1, 1, 1, 2, 0, 0, 0, 0},
	 {0, 1, 1, 1, 1, 0, 0, 0, 0},
	 {0, 0, 1, 1, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 0, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {1, 1, 1, 1, 2, 1, 1, 1, 1},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {1, 1, 1, 1, 2, 1, 1, 1, 1},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 1, 1, 1, 0, 0, 0},
     {0, 0, 1, 0, 0, 0, 1, 0, 0},
     {0, 1, 0, 0, 0, 0, 0, 1, 0},
     {1, 0, 0, 0, 0, 0, 0, 0, 1},
     {1, 0, 0, 0, 2, 0, 0, 0, 1},
     {1, 0, 0, 0, 0, 0, 0, 0, 1},
     {0, 1, 0, 0, 0, 0, 0, 1, 0},
     {0, 0, 1, 0, 0, 0, 1, 0, 0},
     {0, 0, 0, 1, 1, 1, 0, 0, 0}},
	{{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 0, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 1, 1, 0, 0},
	 {0, 0, 0, 0, 1, 1, 1, 1, 0},
	 {0, 0, 0, 0, 2, 1, 1, 1, 1},
	 {0, 0, 0, 0, 1, 1, 1, 1, 0},
	 {0, 0, 0, 0, 1, 1, 1, 0, 0},
	 {0, 0, 0, 0, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 0, 0, 0, 0},
	 {0, 0, 1, 1, 1, 0, 0, 0, 0},
	 {0, 1, 1, 1, 1, 0, 0, 0, 0},
	 {1, 1, 1, 1, 2, 0, 0, 0, 0},
	 {0, 1, 1, 1, 1, 0, 0, 0, 0},
	 {0, 0, 1, 1, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 0, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 1, 0, 0, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {1, 1, 1, 1, 2, 1, 1, 1, 1},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0}},
    {{0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {0, 0, 0, 0, 0, 0, 0, 0, 0},
	 {1, 1, 1, 1, 2, 1, 1, 1, 1},
	 {0, 1, 1, 1, 1, 1, 1, 1, 0},
	 {0, 0, 1, 1, 1, 1, 1, 0, 0},
	 {0, 0, 0, 1, 1, 1, 0, 0, 0},
	 {0, 0, 0, 0, 1, 0, 0, 0, 0}},
    {{0, 0, 0, 1, 1, 1, 0, 0, 0},
     {0, 0, 1, 0, 0, 0, 1, 0, 0},
     {0, 1, 0, 0, 0, 0, 0, 1, 0},
     {1, 0, 0, 0, 0, 0, 0, 0, 1},
     {1, 0, 0, 0, 2, 0, 0, 0, 1},
     {1, 0, 0, 0, 0, 0, 0, 0, 1},
     {0, 1, 0, 0, 0, 0, 0, 1, 0},
     {0, 0, 1, 0, 0, 0, 1, 0, 0},
     {0, 0, 0, 1, 1, 1, 0, 0, 0}},
}

--for each area sets the type of damage and effect
for i = 1, #area do
	combat[i] = Combat()
    combat[i]:setParameter(COMBAT_PARAM_TYPE, COMBAT_ICEDAMAGE)
    combat[i]:setParameter(COMBAT_PARAM_EFFECT, CONST_ME_ICETORNADO)
end

for x, _ in ipairs(area) do
    combat[x]:setArea(createCombatArea(area[x]))
end

--if is not a player or player is null does nothing if it is executes the combat
function executeCombat(p, i)
    if not p.player then
        return false
    end
    if not p.player:isPlayer() then
		return false
    end
    p.combat[i]:execute(p.player, p.var)
end

function onCastSpell(player, variant)

	local p = {player = player, var = variant, combat = combat}

	local level = player:getLevel()
    local magicLevel = player:getMagicLevel()
	--Calculates de formula
	local min = (level / 5) + (magicLevel * 5.5) + 25
	local max = (level / 5) + (magicLevel * 11) + 50

	for i = 1, #area do
        combat[i]:setFormula(COMBAT_FORMULA_LEVELMAGIC, 0, -min, 0, -max)
		--increments the delay a bit each time
        addEvent(executeCombat, (animationDelay * i) , p, i)
    end		

	return true
end
